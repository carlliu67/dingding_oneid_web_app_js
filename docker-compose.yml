services:
  # 前端服务
  front-end:
    build: .
    image: dingding-front-end:latest
    container_name: dingding-front-end
    ports:
      - "7000:7000"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      # 项目名称，用于生成节点名称
      - COMPOSE_PROJECT_NAME=dingtalk
      # 容器名称，用于标识节点
      - CONTAINER_NAME=dingding-front-end
    command: ["front-end"]
    restart: unless-stopped
    networks:
      - dingding-network
    volumes:
      - ./config/front-end:/app/src/config
      - ./logs:/app/logs
      - ./data/front-end:/app/data
    profiles:
      - front-end

  # 后端服务
  back-end:
    build: .
    image: dingding-back-end:latest
    container_name: dingding-back-end
    ports:
      - "7001:7001"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      # 项目名称，用于生成节点名称
      - COMPOSE_PROJECT_NAME=dingtalk
      # 容器名称，用于标识节点
      - CONTAINER_NAME=dingding-back-end
    command: ["back-end"]
    restart: unless-stopped
    networks:
      - dingding-network
    volumes:
      - ./config/back-end:/app/server/config
      - ./logs:/app/logs
      - ./data/back-end:/app/data
    profiles:
      - back-end

  # Webhook服务
  webhook:
    build: .
    image: dingding-webhook:latest
    container_name: dingding-webhook
    ports:
      - "7002:7002"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - PORT=7002
      # 项目名称，用于生成节点名称
      - COMPOSE_PROJECT_NAME=dingtalk
      # 容器名称，用于标识节点
      - CONTAINER_NAME=dingding-webhook
    command: ["webhook"]
    restart: unless-stopped
    networks:
      - dingding-network
    volumes:
      - ./config/webhook:/app/server/config
      - ./logs:/app/logs
      - ./data/webhook:/app/data
    profiles:
      - webhook

  # 完整服务（前后端+webhook）
  full:
    build: .
    image: dingding-full:latest
    container_name: dingding-full
    ports:
      - "7000:7000"
      - "7001:7001"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      # 项目名称，用于生成节点名称
      - COMPOSE_PROJECT_NAME=dingtalk
      # 容器名称，用于标识节点
      - CONTAINER_NAME=dingding-full
    command: ["full"]
    restart: unless-stopped
    networks:
      - dingding-network
    volumes:
      - ./config/full:/app/server/config
      - ./logs:/app/logs
      - ./data/full:/app/data
    profiles:
      - full

networks:
  dingding-network:
    driver: bridge